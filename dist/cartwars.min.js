!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var Sprite=require("./sprite");this.animatedSprite=function(data){var that=new Sprite(data),super_draw=that.superior("draw"),currentFrame=0,started=!1;function startAnimation(){(currentFrame+=1)<Object.keys(data.parts).length?setTimeout(function(){startAnimation()},300):(currentFrame=0,started=!1)}return that.draw=function(dContext){return super_draw(dContext,(started||(started=!0,startAnimation()),Object.keys(data.parts)[currentFrame]))},that.startAnimation=startAnimation,that},void 0!==module&&(module.exports=this.animatedSprite)},{"./sprite":11}],2:[function(require,module,exports){CanvasRenderingContext2D.prototype.storeLoadedImage=function(key,image){this.images||(this.images={}),this.images[key]=image},CanvasRenderingContext2D.prototype.getLoadedImage=function(key){if(this.images[key])return this.images[key]},CanvasRenderingContext2D.prototype.followSprite=function(sprite){this.centralSprite=sprite},CanvasRenderingContext2D.prototype.getCentralPosition=function(){return this.centralOffsetX||(this.centralOffsetX=0),this.centralOffsetY||(this.centralOffsetY=0),{map:this.centralSprite.mapPosition,canvas:[Math.round(.5*this.canvas.width)+this.centralOffsetX,Math.round(.33*this.canvas.height)+this.centralOffsetY,0]}},CanvasRenderingContext2D.prototype.setCentralPositionOffset=function(offsetX,offsetY){this.centralOffsetX=offsetX,this.centralOffsetY=offsetY},CanvasRenderingContext2D.prototype.mapPositionToCanvasPosition=function(position){var central=this.getCentralPosition(),centralMapPosition=central.map,central=central.canvas,mapDifferenceX=centralMapPosition[0]-position[0],centralMapPosition=centralMapPosition[1]-position[1];return[central[0]-mapDifferenceX,central[1]-centralMapPosition]},CanvasRenderingContext2D.prototype.canvasPositionToMapPosition=function(position){var central=this.getCentralPosition(),centralMapPosition=central.map,central=central.canvas,mapDifferenceX=central[0]-position[0],central=central[1]-position[1];return[centralMapPosition[0]-mapDifferenceX,centralMapPosition[1]-central]},CanvasRenderingContext2D.prototype.getCentreOfViewport=function(){return(this.canvas.width/2).floor()},CanvasRenderingContext2D.prototype.getMiddleOfViewport=function(){return(this.canvas.height/2).floor()},CanvasRenderingContext2D.prototype.getBelowViewport=function(){return this.canvas.height.floor()},CanvasRenderingContext2D.prototype.getMapBelowViewport=function(){var below=this.getBelowViewport();return this.canvasPositionToMapPosition([0,below])[1]},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfCanvas=function(buffer){var min=0,max=this.canvas.width;return buffer&&(min-=buffer,max+=buffer),Number.random(min,max)},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfMap=function(buffer){buffer=this.getRandomlyInTheCentreOfCanvas(buffer);return this.canvasPositionToMapPosition([buffer,0])[0]},CanvasRenderingContext2D.prototype.getRandomMapPositionBelowViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas(),yCanvas=this.getBelowViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])},CanvasRenderingContext2D.prototype.getRandomMapPositionAboveViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas(),yCanvas=this.getAboveViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])},CanvasRenderingContext2D.prototype.getTopOfViewport=function(){return this.canvasPositionToMapPosition([0,0])[1]},CanvasRenderingContext2D.prototype.getAboveViewport=function(){return 0-(this.canvas.height/4).floor()}},{}],3:[function(require,module,exports){Function.prototype.method=function(name,func){return this.prototype[name]=func,this},Object.method("superior",function(name){var that=this,method=that[name];return function(){return method.apply(that,arguments)}})},{}],4:[function(require,module,exports){var SpriteArray=require("./spriteArray"),EventedLoop=require("eventedloop");"undefined"!=typeof navigator?navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate:navigator={vibrate:!1},this.game=function(mainCanvas,player){var staticObjects=new SpriteArray,movingObjects=new SpriteArray,uiElements=new SpriteArray,dContext=mainCanvas.getContext("2d"),showHitBoxes=!1,backgroundImage=dContext.getLoadedImage("assets/background.jpg"),backgroundX=0,backgroundY=0,mouseX=dContext.getCentreOfViewport(),mouseY=0,paused=!1,gameEnding=!1,beforeCycleCallbacks=[],afterCycleCallbacks=[],gameLoop=new EventedLoop,isShaking=(this.toggleHitBoxes=function(){showHitBoxes=!showHitBoxes,staticObjects.each(function(sprite){sprite.setHitBoxesVisible(showHitBoxes)})},this.addStaticObject=function(sprite){sprite.setHitBoxesVisible(showHitBoxes),staticObjects.push(sprite)},this.addStaticObjects=function(sprites){sprites.forEach(this.addStaticObject.bind(this))},this.addMovingObject=function(movingObject,movingObjectType){movingObjectType&&staticObjects.onPush(function(obj){obj.data&&obj.data.hitBehaviour[movingObjectType]&&obj.onHitting(movingObject,obj.data.hitBehaviour[movingObjectType])},!0),movingObject.setHitBoxesVisible(showHitBoxes),movingObjects.push(movingObject)},this.addUIElement=function(element){uiElements.push(element)},this.beforeCycle=function(callback){beforeCycleCallbacks.push(callback)},this.afterCycle=function(callback){afterCycleCallbacks.push(callback)},this.setMouseX=function(x){mouseX=x},this.setMouseY=function(y){mouseY=y},player.setMapPosition(0,0),player.setMapPositionTarget(0,-10),dContext.followSprite(player),!(this.cycle=function(){beforeCycleCallbacks.each(function(c){c()});var mouseMapPosition=dContext.canvasPositionToMapPosition([mouseX,mouseY]);player.isJumping||player.setMapPositionTarget(mouseMapPosition[0],mouseMapPosition[1]),player.cycle(),movingObjects.cull(),movingObjects.each(function(movingObject,i){movingObject.cycle(dContext)}),staticObjects.cull(),staticObjects.each(function(staticObject,i){staticObject.cycle&&staticObject.cycle(),staticObject.getCanvasPositionY()<-100&&staticObject.deleteOnNextCycle()}),uiElements.each(function(uiElement,i){uiElement.cycle&&uiElement.cycle()}),isShaking=movingObjects.some(item=>"monster"==item.data.name&&!item.isFull&&!item.isEating),afterCycleCallbacks.each(function(c){c()})})),shakeDuration=200,shakeStartTime=-1;function startShake(){isShaking&&(shakeStartTime=Date.now())}this.draw=function(){var ctx,dt,dx,easing;mainCanvas.width=mainCanvas.width,backgroundImage.width=mainCanvas.width,backgroundImage.height=mainCanvas.height,backgroundX=player.mapPosition[0]%backgroundImage.width*-1,backgroundY=player.mapPosition[1]%backgroundImage.height*-1,dContext.drawImage(backgroundImage,backgroundX,backgroundY,mainCanvas.width,backgroundImage.height),dContext.drawImage(backgroundImage,backgroundX+mainCanvas.width,backgroundY,mainCanvas.width,backgroundImage.height),dContext.drawImage(backgroundImage,backgroundX-mainCanvas.width,backgroundY,mainCanvas.width,backgroundImage.height),dContext.drawImage(backgroundImage,backgroundX,backgroundY+mainCanvas.height,mainCanvas.width,backgroundImage.height),dContext.drawImage(backgroundImage,backgroundX+mainCanvas.width,backgroundY+mainCanvas.height,mainCanvas.width,backgroundImage.height),dContext.drawImage(backgroundImage,backgroundX-mainCanvas.width,backgroundY+mainCanvas.height,mainCanvas.width,backgroundImage.height),ctx=dContext,-1!=(shakeStartTime=isShaking?shakeStartTime:-1)&&(dt=Date.now()-shakeStartTime,shakeDuration<dt?shakeStartTime=-1:(easing=Math.pow(dt/shakeDuration-1,3)+1,ctx.save(),dx=easing*(Math.cos(.1*dt)+Math.cos(.3115*dt))*3,easing=easing*(Math.sin(.05*dt)+Math.sin(.057113*dt))*3,ctx.translate(dx,easing),navigator.vibrate(100))),staticObjects.each(function(staticObject,i){staticObject.isDrawnUnderPlayer&&staticObject.draw&&staticObject.draw(dContext,"main")}),player.setHitBoxesVisible(showHitBoxes),player.draw(dContext),player.cycle(),movingObjects.each(function(movingObject,i){movingObject.draw(dContext)}),staticObjects.each(function(staticObject,i){!staticObject.isDrawnUnderPlayer&&staticObject.draw&&staticObject.draw(dContext,"main")}),uiElements.each(function(uiElement,i){uiElement.draw&&uiElement.draw(dContext,"main")}),function(ctx){-1!=shakeStartTime&&ctx.restore()}(dContext)},this.start=function(){gameLoop.start()},this.pause=function(){paused=!0,gameLoop.stop()},this.gameOver=function(){gameEnding=!0},this.isPaused=function(){return paused},this.isGameEnding=function(){return gameEnding},this.reset=function(){gameEnding=paused=!1,staticObjects=new SpriteArray,movingObjects=new SpriteArray,mouseX=dContext.getCentreOfViewport(),mouseY=0,player.reset(),player.setMapPosition(0,0,0),this.start()}.bind(this),gameLoop.on("20",this.cycle),gameLoop.on("20",this.draw),startShake(),setInterval(startShake,300,dContext)},void 0!==module&&(module.exports=this.game)},{"./spriteArray":12,eventedloop:16}],5:[function(require,module,exports){void 0!==module&&(module.exports=function(data){var that=this,hudImage=new Image;return hudImage.src="assets/CartWars-small.png",that.lines=data.initialLines,that.top=data.position.top,that.right=data.position.right,that.bottom=data.position.bottom,that.left=data.position.left,that.width=data.width,that.height=data.height,that.setLines=function(lines){that.lines=lines},that.draw=function(ctx){ctx.drawImage(hudImage,20,5),ctx.font="12px monospace";var yOffset=0;that.lines.each(function(line){var xPos,yPos,fontSize=+ctx.font.slice(0,2),textWidth=ctx.measureText(line).width,fontSize=1.3*fontSize;that.top?yPos=that.top+yOffset:that.bottom&&(yPos=ctx.canvas.height-that.top-fontSize+yOffset),that.right?xPos=ctx.canvas.width-that.right-textWidth:that.left&&(xPos=that.left),yOffset+=fontSize,ctx.fillStyle="#FFFFFF",ctx.fillText(line,xPos,yPos)})},that})},{}],6:[function(require,module,exports){this.guid=function(){function S4(){return Math.floor(65536*Math.random()).toString(16)}return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},void 0!==module&&(module.exports=this.guid)},{}],7:[function(require,module,exports){module.exports=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}},{}],8:[function(require,module,exports){var Sprite=require("./sprite");this.monster=function(data){var that=new Sprite(data),super_draw=that.superior("draw"),spriteVersion=1,eatingStage=0;return that.isEating=!1,that.isFull=!1,that.isChasing=!1,that.resetSpeed=function(){that.isChasing?that.setSpeed(12):that.setSpeed(8)},that.setStandardSpeed=function(){that.isChasing=!1,that.setSpeed(8)},that.setObstacleHitSpeed=function(){that.setSpeed(5),setTimeout(that.resetSpeed,300)},that.startChasing=function(){that.isChasing=!0,that.setSpeed(12),setTimeout(that.setStandardSpeed,2e3)},that.startChasing(),that.draw=function(dContext){return super_draw(dContext,(dContext=that.movingToward[0]-that.canvasX,that.isEating?"eating"+eatingStage:(2<spriteVersion+.1?spriteVersion=.1:spriteVersion+=.1,0<=dContext?"sEast"+Math.ceil(spriteVersion):dContext<0?"sWest"+Math.ceil(spriteVersion):void 0)))},that.startEating=function startEating(whenDone){eatingStage+=1,that.isEating=!0,that.isMoving=!1,eatingStage<6||(eatingStage=1),setTimeout(function(){startEating(whenDone)},300)},that},void 0!==module&&(module.exports=this.monster)},{"./sprite":11}],9:[function(require,module,exports){var Sprite=require("./sprite");"undefined"!=typeof navigator?navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate:navigator={vibrate:!1},this.player=function(data){var cancelableStateTimeout,cancelableStateInterval,discreteDirections={west:270,wsWest:240,sWest:195,south:180,sEast:165,esEast:120,east:90},that=new Sprite(data),sup={draw:that.superior("draw"),cycle:that.superior("cycle"),getSpeedX:that.superior("getSpeedX"),getSpeedY:that.superior("getSpeedY"),hits:that.superior("hits")},directions_esEast=function(xDiff){return 300<xDiff},directions_sEast=function(xDiff){return 75<xDiff},directions_wsWest=function(xDiff){return xDiff<-300},directions_sWest=function(xDiff){return xDiff<-75},obstaclesHit=[],pixelsTravelled=0,turnEaseCycles=70,speedX=0,speedXFactor=0,speedY=0,speedYFactor=1,trickStep=0,crashingFrame=0;function setNormal(){that.isBeingEaten||(that.setSpeed(5),that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!1,that.isPerformingTrick=!1,that.isCrashing=!1,that.isBoosted=!1,that.isSlowed=!1,cancelableStateInterval&&clearInterval(cancelableStateInterval),that.setMapPosition(void 0,void 0,0))}function getDiscreteDirection(){if(that.direction)return that.direction<=90?"east":90<that.direction&&that.direction<150?"esEast":150<=that.direction&&that.direction<180?"sEast":180===that.direction?"south":180<that.direction&&that.direction<=210?"sWest":210<that.direction&&that.direction<270?"wsWest":270<=that.direction?"west":"south";var xDiff=that.movingToward[0]-that.mapPosition[0];return that.movingToward[1]-that.mapPosition[1]<=0?0<xDiff?"east":"west":directions_esEast(xDiff)?"esEast":directions_sEast(xDiff)?"sEast":directions_wsWest(xDiff)?"wsWest":directions_sWest(xDiff)?"sWest":"south"}function setDiscreteDirection(d){discreteDirections[d]&&that.setDirection(discreteDirections[d]),that.isMoving="west"!==d&&"east"!==d}function easeSpeedToTargetUsingFactor(sp,targetSpeed,f){return 0===f||1===f?targetSpeed:(sp<targetSpeed&&(sp+=that.getSpeed()*(f/turnEaseCycles)),targetSpeed<sp&&(sp-=that.getSpeed()*(f/turnEaseCycles)),sp)}return that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!1,that.isPerformingTrick=!1,that.isCrashing=!1,that.isBoosting=!1,that.isSlowed=!1,that.availableAwake=100,that.onHitObstacleCb=function(){},that.onCollectItemCb=function(){},that.onHitMonsterCb=function(){},that.setSpeed(5),setInterval(()=>{that.isMoving&&!that.isBoosting&&(that.availableAwake=95<=that.availableAwake?100:that.availableAwake+5)},3e3),that.reset=function(){obstaclesHit=[],pixelsTravelled=0,that.isMoving=!0,that.hasBeenHit=!1,that.availableAwake=100,that.isCrashing=!1,that.isBeingEaten=!1,setNormal()},that.stop=function(){180<that.direction?setDiscreteDirection("west"):setDiscreteDirection("east")},that.turnEast=function(){switch(getDiscreteDirection()){case"west":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("east");break;default:setDiscreteDirection("south")}},that.turnWest=function(){switch(getDiscreteDirection()){case"east":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("west");break;default:setDiscreteDirection("south")}},that.stepWest=function(){that.mapPosition[0]-=2*that.speed},that.stepEast=function(){that.mapPosition[0]+=2*that.speed},that.setMapPositionTarget=function(x,y){that.hasBeenHit||(Math.abs(that.mapPosition[0]-x)<=75&&(x=that.mapPosition[0]),that.movingToward=[x,y])},that.startMovingIfPossible=function(){that.hasBeenHit||that.isBeingEaten||(that.isMoving=!0)},that.setTurnEaseCycles=function(c){turnEaseCycles=c},that.getPixelsTravelledDownRoad=function(){return pixelsTravelled},that.resetSpeed=function(){that.setSpeed(5)},that.cycle=function(){that.getSpeedX()<=0&&that.getSpeedY()<=0&&(that.isMoving=!1);var direction=getDiscreteDirection();that.isMoving&&"east"!==direction&&"west"!==direction&&(pixelsTravelled+=that.speed),that.isJumping&&that.setMapPositionTarget(void 0,that.mapPosition[1]+that.getSpeed()),sup.cycle(),that.checkHittableObjects()},that.draw=function(dContext){return sup.draw(dContext,that.isBeingEaten?"blank":that.isJumping?"jumping":that.isCrashing?"wreck"+crashingFrame:that.isBoosting?"boost":getDiscreteDirection())},that.hits=function(obs){return-1===obstaclesHit.indexOf(obs.id)&&(!!obs.occupiesZIndex(that.mapPosition[2])&&!!sup.hits(obs))},that.speedBoost=function(){!that.isBoosting&&!that.isCrashing&&that.isMoving&&50<=that.availableAwake&&(that.availableAwake-=50,that.setSpeed(2*that.speed),that.isBoosting=!0,setTimeout(function(){that.setSpeed(5),that.isBoosting=!1},2e3))},that.attemptTrick=function(){that.isJumping&&(that.isPerformingTrick=!0,cancelableStateInterval=setInterval(function(){2<=trickStep?trickStep=0:trickStep+=1},300))},that.getStandardSpeed=function(){return 5},that.getSpeedX=function(){switch(getDiscreteDirection()){case"esEast":case"wsWest":return speedXFactor=.5,speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor);case"sEast":case"sWest":return speedXFactor=.33,speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor)}return speedX=easeSpeedToTargetUsingFactor(speedX,0,speedXFactor)},that.setSpeedY=function(sy){speedY=sy},that.getSpeedY=function(){if(that.isJumping)return speedY;switch(getDiscreteDirection()){case"esEast":case"wsWest":return speedY=easeSpeedToTargetUsingFactor(speedY,(speedYFactor=.6)*that.getSpeed(),.6);case"esEast":case"wsWest":return speedY=easeSpeedToTargetUsingFactor(speedY,(speedYFactor=.85)*that.getSpeed(),.85);case"east":case"west":return speedYFactor=1,speedY=0}return speedY=easeSpeedToTargetUsingFactor(speedY,that.getSpeed(),speedYFactor)},that.hasHitObstacle=function(obs){that.hasBeenHit=!0,that.isCrashing=!0,that.isJumping=!1,that.isPerformingTrick=!1,that.startCrashing(),cancelableStateInterval&&clearInterval(cancelableStateInterval),that.setMapPosition(void 0,void 0,0),navigator.vibrate&&navigator.vibrate(500),obstaclesHit.push(obs.id),that.resetSpeed(),that.onHitObstacleCb(obs),cancelableStateTimeout&&clearTimeout(cancelableStateTimeout),cancelableStateTimeout=setTimeout(function(){setNormal()},1500)},that.hasHitMonster=function(monster){},that.hasHitJump=function(){var currentSpeed;currentSpeed=that.getSpeed(),setDiscreteDirection("south"),that.setSpeed(currentSpeed+2),that.setSpeedY(currentSpeed+2),that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!0,that.setMapPosition(void 0,void 0,1),cancelableStateTimeout&&clearTimeout(cancelableStateTimeout),cancelableStateTimeout=setTimeout(function(){setNormal()},1e3)},that.hasHitOilSlick=function(){that.setSpeed(7),that.isMoving=!0,cancelableStateTimeout&&clearTimeout(cancelableStateTimeout),cancelableStateTimeout=setTimeout(function(){setNormal()},200)},that.hasHitCollectible=function(item){that.onCollectItemCb(item)},that.isEatenBy=function(monster,whenEaten){that.onHitMonsterCb(),that.hasHitMonster(monster),monster.startEating(whenEaten),obstaclesHit.push(monster.id),that.isMoving=!1,that.isBeingEaten=!0},that.reset=function(){obstaclesHit=[],pixelsTravelled=0,that.isMoving=!0,that.isJumping=!1,that.hasBeenHit=!1,that.availableAwake=100,that.isBeingEaten=!1,that.isBoosted=!1,that.isBoosting=!1},that.setHitObstacleCb=function(fn){that.onHitObstacleCb=fn||function(){}},that.setHitMonsterCb=function(fn){that.onHitMonsterCb=fn||function(){}},that.setCollectItemCb=function(fn){that.onCollectItemCb=fn||function(){}},that.startCrashing=function startCrashing(){crashingFrame+=1,that.isCrashing=!0,that.isBoosting=!1,that.setSpeed(1),crashingFrame<6?setTimeout(function(){startCrashing()},100):(crashingFrame=0,that.isCrashing=!1,that.isMoving=!1,that.resetSpeed())},that},void 0!==module&&(module.exports=this.player)},{"./sprite":11}],10:[function(require,module,exports){function noop(){}for(var method,methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)console[method=methods[length]]||(console[method]=noop)},{}],11:[function(require,module,exports){function Sprite(data){var trackedSpriteToMoveToward,hittableObjects={},zIndexesOccupied=[0],that=this,showHitBoxes=!1;function getHitBox(forZIndex){if(that.data.hitBoxes&&data.hitBoxes[forZIndex])return data.hitBoxes[forZIndex]}function roundHalf(num){return num=Math.round(2*num)/2}return that.direction=void 0,that.mapPosition=[0,0,0],that.id=GUID(),that.canvasX=0,that.canvasY=0,that.canvasZ=0,that.height=0,that.speed=0,that.data=data||{parts:{}},that.movingToward=[0,0],that.metresDownTheRoad=0,that.movingWithConviction=!1,that.deleted=!1,that.maxHeight=Object.values(that.data.parts).map(function(p){return p[3]}).max(),that.isMoving=!0,that.isDrawnUnderPlayer=data.isDrawnUnderPlayer,that.data.parts?that.currentFrame=that.data.parts[0]:(that.data.parts={},that.currentFrame=void 0),data&&data.id&&(that.id=data.id),data&&data.zIndexesOccupied&&(zIndexesOccupied=data.zIndexesOccupied),this.setHitBoxesVisible=function(show){showHitBoxes=show},this.draw=function(dCtx,spriteFrame){that.currentFrame=that.data.parts[spriteFrame];var spriteFrame=that.currentFrame,newCanvasPosition=(that.height=spriteFrame[3],that.width=spriteFrame[2],dCtx.mapPositionToCanvasPosition(that.mapPosition)),newCanvasPosition=(that.setCanvasPosition(newCanvasPosition[0],newCanvasPosition[1]),4<spriteFrame.length?spriteFrame[4]:0),offsetY=5<spriteFrame.length?spriteFrame[5]:0;dCtx.drawImage(dCtx.getLoadedImage(that.data.$imageFile),spriteFrame[0],spriteFrame[1],spriteFrame[2],spriteFrame[3],that.canvasX+newCanvasPosition,that.canvasY+offsetY,spriteFrame[2],spriteFrame[3]),function(dCtx,spritePart){if(showHitBoxes){var left,top,right,hitBox,hitboxOffsetX=6<spritePart.length?spritePart[6]:0,hitboxOffsetY=7<spritePart.length?spritePart[7]:0;for(const box in that.data.hitBoxes)Object.hasOwnProperty.call(that.data.hitBoxes,box)&&(hitBox=that.data.hitBoxes[box],left=hitBox[0]+hitboxOffsetX,top=hitBox[1]+hitboxOffsetY,right=hitBox[2]+hitboxOffsetX,hitBox=hitBox[3]+hitboxOffsetY,dCtx.strokeStyle="yellow",dCtx.strokeRect(that.canvasX+left,that.canvasY+top,right-left,hitBox-top))}}(dCtx,spriteFrame)},this.setMapPosition=function(x,y,z){void 0===x&&(x=that.mapPosition[0]),void 0===y&&(y=that.mapPosition[1]),void 0===z?z=that.mapPosition[2]:that.zIndexesOccupied=[z],that.mapPosition=[x,y,z]},this.setCanvasPosition=function(cx,cy){cx&&(!Object.isString(cx)||"+"!==cx.first()&&"-"!==cx.first()?that.canvasX=cx:that.canvasX+=cx.toNumber()),cy&&(!Object.isString(cy)||"+"!==cy.first()&&"-"!==cy.first()?that.canvasY=cy:function(amount){that.canvasY+=amount.toNumber()}(cy))},this.getCanvasPositionX=function(){return that.canvasX},this.getCanvasPositionY=function(){return that.canvasY},this.getLeftHitBoxEdge=function(zIndex){zIndex=zIndex||0;let lhbe=this.getCanvasPositionX();zIndex=getHitBox(zIndex);return zIndex&&(lhbe+=zIndex[0]),lhbe},this.getTopHitBoxEdge=function(zIndex){zIndex=zIndex||0;let thbe=this.getCanvasPositionY();zIndex=getHitBox(zIndex);return zIndex&&(thbe+=zIndex[1]),thbe},this.getRightHitBoxEdge=function(zIndex){zIndex=getHitBox(zIndex=zIndex||0);return zIndex?that.canvasX+zIndex[2]:that.canvasX+that.width},this.getBottomHitBoxEdge=function(zIndex){zIndex=getHitBox(zIndex=zIndex||0);return zIndex?that.canvasY+zIndex[3]:that.canvasY+that.height},this.getPositionInFrontOf=function(){return[that.canvasX,that.canvasY+that.height]},this.setSpeed=function(s){that.lastSpeed=that.speed,that.speed=s,that.speedX=s,that.speedY=s},this.incrementSpeedBy=function(s){that.speed+=s},that.getSpeed=function(){return that.speed},that.getSpeedX=function(){return that.speed},that.getSpeedY=function(){return that.speed},this.setHeight=function(h){that.height=h},this.setWidth=function(w){that.width=w},this.getMaxHeight=function(){return that.maxHeight},that.getMovingTowardOpposite=function(){if(!that.isMoving)return[0,0];var dx=that.movingToward[0]-that.mapPosition[0],dy=that.movingToward[1]-that.mapPosition[1];return[75<Math.abs(dx)?0-dx:0,-dy]},this.checkHittableObjects=function(){Object.keys(hittableObjects,function(k,objectData){objectData.object.deleted?delete hittableObjects[k]:objectData.object.hits(that)&&objectData.callbacks.each(function(callback){callback(that,objectData.object)})})},this.cycle=function(){if(that.checkHittableObjects(),trackedSpriteToMoveToward&&that.setMapPositionTarget(trackedSpriteToMoveToward.mapPosition[0],trackedSpriteToMoveToward.mapPosition[1],!0),that.isMoving){let currentX=that.mapPosition[0],currentY=that.mapPosition[1];var d;void 0!==that.direction?((d=that.direction-90)<0&&(d=360+d),currentX+=roundHalf(that.speed*Math.cos(d*(Math.PI/180))),currentY+=roundHalf(that.speed*Math.sin(d*(Math.PI/180)))):(void 0!==that.movingToward[0]&&(currentX>that.movingToward[0]?currentX-=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0])):currentX<that.movingToward[0]&&(currentX+=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0])))),void 0!==that.movingToward[1]&&(currentY>that.movingToward[1]?currentY-=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1])):currentY<that.movingToward[1]&&(currentY+=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1]))))),that.setMapPosition(currentX,currentY)}},this.setMapPositionTarget=function(x,y,override){override&&(that.movingWithConviction=!1),that.movingWithConviction||(void 0===x&&(x=that.movingToward[0]),void 0===y&&(y=that.movingToward[1]),that.movingToward=[x,y],that.movingWithConviction=!1)},this.setDirection=function(angle){that.direction=angle=360<=angle?360-angle:angle,that.movingToward=void 0},this.resetDirection=function(){that.direction=void 0},this.setMapPositionTargetWithConviction=function(cx,cy){that.setMapPositionTarget(cx,cy),that.movingWithConviction=!0},this.follow=function(sprite){trackedSpriteToMoveToward=sprite},this.stopFollowing=function(){trackedSpriteToMoveToward=!1,setTimeout(that.deleteOnNextCycle,5e3)},this.onHitting=function(objectToHit,callback){if(hittableObjects[objectToHit.id])return hittableObjects[objectToHit.id].callbacks.push(callback);hittableObjects[objectToHit.id]={object:objectToHit,callbacks:[callback]}},this.deleteOnNextCycle=function(){that.deleted=!0},this.occupiesZIndex=function(z){return 0<=zIndexesOccupied.indexOf(z)},this.hits=function(other){var rect1x=other.getLeftHitBoxEdge(that.mapPosition[2]),rect1w=other.getRightHitBoxEdge(that.mapPosition[2])-rect1x,rect1y=other.getTopHitBoxEdge(that.mapPosition[2]),other=other.getBottomHitBoxEdge(that.mapPosition[2])-rect1y,isarray=Array.isArray(that.currentFrame),hitboxOffsetX=isarray&&6<that.currentFrame.length?that.currentFrame[6]:0,isarray=isarray&&7<that.currentFrame.length?that.currentFrame[7]:0,rect2x=that.getLeftHitBoxEdge(that.mapPosition[2])+hitboxOffsetX,hitboxOffsetX=that.getRightHitBoxEdge(that.mapPosition[2])-rect2x+hitboxOffsetX,rect2y=that.getTopHitBoxEdge(that.mapPosition[2])+isarray,isarray=that.getBottomHitBoxEdge(that.mapPosition[2])-rect2y+isarray;return rect1x<rect2x+hitboxOffsetX&&rect2x<rect1x+rect1w&&rect1y<rect2y+isarray&&rect2y<other+rect1y},this.isAboveOnCanvas=function(cy){return that.canvasY+that.height<cy},this.isBelowOnCanvas=function(cy){return that.canvasY>cy},that}var global,GUID;global=this,GUID=require("./guid"),Sprite.createObjects=function(spriteInfoArray,opts){Array.isArray(spriteInfoArray)||(spriteInfoArray=[spriteInfoArray]),opts=Object.merge(opts,{rateModifier:0,dropRate:1,position:[0,0]},!1,!1);var AnimatedSprite=require("./animatedSprite");return spriteInfoArray.map(function(spriteInfo){var sprite,position=opts.position;if(Number.random(100+opts.rateModifier)<=spriteInfo.dropRate)return(sprite=new(spriteInfo.sprite.animated?AnimatedSprite:Sprite)(spriteInfo.sprite)).setSpeed(0),Object.isFunction(position)&&(position=position()),sprite.setMapPosition(position[0],position[1]),spriteInfo.sprite.hitBehaviour&&spriteInfo.sprite.hitBehaviour.player&&opts.player&&sprite.onHitting(opts.player,spriteInfo.sprite.hitBehaviour.player),sprite}).remove(void 0)},global.sprite=Sprite,void 0!==module&&(module.exports=this.sprite)},{"./animatedSprite":1,"./guid":6}],12:[function(require,module,exports){function SpriteArray(){return this.pushHandlers=[],this}var global;global=this,(SpriteArray.prototype=Object.create(Array.prototype)).onPush=function(f,retroactive){this.pushHandlers.push(f),retroactive&&this.each(f)},SpriteArray.prototype.push=function(obj){Array.prototype.push.call(this,obj),this.pushHandlers.each(function(handler){handler(obj)})},SpriteArray.prototype.cull=function(){this.each(function(obj,i){if(obj.deleted)return delete this[i]})},global.spriteArray=SpriteArray,void 0!==module&&(module.exports=this.spriteArray)},{}],13:[function(require,module,exports){require("./lib/canvasRenderingContext2DExtensions"),require("./lib/extenders"),require("./lib/plugins");var playSound,currentTrack,Mousetrap=require("br-mousetrap"),Monster=(require("./lib/isMobileDevice"),require("./lib/spriteArray"),require("./lib/monster")),Sprite=(require("./lib/animatedSprite"),require("./lib/sprite")),Player=require("./lib/player"),GameHud=require("./lib/gameHud"),Game=require("./lib/game"),mainCanvas=document.getElementById("game-canvas"),dContext=mainCanvas.getContext("2d",{alpha:!1}),sounds={track1:"assets/music/track1.ogg",track2:"assets/music/track2.ogg",track3:"assets/music/track3.ogg",gameOver:"assets/music/gameover.ogg"},playingTrackNumber=1,sprites=require("./spriteInfo"),pixelsPerMetre=(require("./lib/monster"),18),monsterDistanceThreshold=2e3;const totalLives=5;var livesLeft=totalLives,highScore=0;const cyrb53=function(str,s=0){let h1=3735928559^s,h2=1103547991^s;for(let i=0,ch;i<str.length;i++)ch=str.charCodeAt(i),h1=Math.imul(h1^ch,2654435761),h2=Math.imul(h2^ch,1597334677);return h1=Math.imul(h1^h1>>>16,2246822507)^Math.imul(h2^h2>>>13,3266489909),4294967296*(2097151&(h2=Math.imul(h2^h2>>>16,2246822507)^Math.imul(h1^h1>>>13,3266489909)))+(h1>>>0)},gameInfo={distance:0,money:0,tokens:0,points:0,cans:0,levelBoost:0,gameEndDateTime:null,god:!1,reset(){this.distance=0,this.money=0,this.tokens=0,this.points=0,this.cans=0,this.levelBoost=0,this.gameEndDateTime=null},getLevel(){return this.distance<100?1:Math.floor(this.distance/100)+this.levelBoost},getScore(){return 100*this.getLevel()+10*this.tokens+10*this.distance},getFormattedScore(){const d=this.gameEndDateTime;return"🛒 CartWars - Serious Shopper 🛒\nDate: "+d.getMonth()+"/"+d.getDate()+"/"+d.getFullYear()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+"\nLevel: "+this.getLevel()+"\nTokens: "+this.tokens+"\nDistance: "+this.distance+"m\nTotal Score: "+this.getScore()+"\nCode: "+cyrb53(this.getLevel().toString()+this.tokens.toString()+this.distance.toString()+this.getScore().toString(),d.getDate()+d.getMonth()+d.getFullYear()+d.getHours()+d.getMinutes()).toString(36)}};var dropRates={trafficConeLarge:1,trafficConeSmall:1,garbageCan:1,jump:1,oilSlick:1,token:3,milkshake:1};function _checkAudioState(sound){}function monsterHitsPlayerBehaviour(monster,player){player.isEatenBy(monster,function(){monster.isFull=!0,monster.isEating=!1,monster.setSpeed(player.getSpeed()),monster.stopFollowing();var randomPositionAbove=dContext.getRandomMapPositionAboveViewport();monster.setMapPositionTarget(randomPositionAbove[0],randomPositionAbove[1])})}function playMusicTrack(nextTrack){nextTrack!==playingTrackNumber&&(currentTrack.muted=!0,(playingTrackNumber=nextTrack)>sounds.length-1&&(playingTrackNumber=1),(currentTrack=sounds["track"+nextTrack]).currentTime=0,currentTrack.loop=!0,playSound&&(currentTrack.play(),currentTrack.muted=!1))}function showValidateCodeMenu(){$("#main").hide(),$("#validatecode").show(),$("#menu").addClass("validatecode")}function resizeCanvas(){mainCanvas.width=window.innerWidth,mainCanvas.height=window.innerHeight}localStorage.getItem("highScore")&&(highScore=localStorage.getItem("highScore")),$(".validate").click(function(){let tokens=$("#validatetext").val().toLowerCase().split(/\r?\n/).filter(function(token){return token.startsWith("date:")||token.startsWith("level:")||token.startsWith("tokens:")||token.startsWith("distance:")||token.startsWith("total score:")||token.startsWith("code:")});function getValue(token){return tokens.find(i=>i.startsWith(token))?.split(": ")[1]}var val=getValue("level:")+getValue("tokens:")+getValue("distance:")?.replace("m","")+getValue("total score:"),d=getValue("date:")?.replaceAll(" ","/")?.replaceAll(":","/")?.split("/");if(null!=val&&null!=d){let s=0;for(let i=0;i<d.length-1;i++)s+=parseInt(d[i]);const c=cyrb53(val,s);if(c.toString(36)==getValue("code:"))return void alert("Code is valid!")}alert("Code is NOT valid!")}),$(".play").click(function(){$("#main").hide(),$("#selectPlayer").show(),$("#menu").addClass("selectPlayer")}),$(".instructions").click(function(){$("#main").hide(),$("#instructions").show(),$("#menu").addClass("instructions")}),$(".credits").click(function(){$("#main").hide(),$("#credits").show(),$("#menu").addClass("credits")}),$(".back").click(function(){$("#credits").hide(),$("#selectPlayer").hide(),$("#instructions").hide(),$("#validatecode").hide(),$("#main").show(),$("#menu").removeClass("credits"),$("#menu").removeClass("selectPlayer"),$("#menu").removeClass("instructions"),$("#menu").removeClass("validatecode")});var sources,next,loaded,images,sound,canUseLocalStorage="localStorage"in window&&null!==window.localStorage;for(sound in canUseLocalStorage&&((playSound="true"===localStorage.getItem("hbwCartRacing.playSound"))?$(".sound").addClass("sound-on").removeClass("sound-off"):$(".sound").addClass("sound-off").removeClass("sound-on")),$(".sound").click(function(){var sound,$this=$(this);for(sound in playSound=$this.hasClass("sound-on")?($this.removeClass("sound-on").addClass("sound-off"),!1):($this.removeClass("sound-off").addClass("sound-on"),!0),canUseLocalStorage&&localStorage.setItem("hbwCartRacing.playSound",playSound),sounds)sounds.hasOwnProperty(sound)&&(sounds[sound].muted=!0,currentTrack.muted=!playSound);playSound&&currentTrack.play()}),window.addEventListener("resize",resizeCanvas,!1),resizeCanvas(),sounds)sounds.hasOwnProperty(sound)&&(src=sounds[sound],function(sound){sounds[sound]=new Audio,sounds[sound].status="loading",sounds[sound].name=sound,sounds[sound].addEventListener("canplay",function(){_checkAudioState.call(sound)}),sounds[sound].src=src,sounds[sound].preload="auto",sounds[sound].load()}(sound));function finish(){(loaded+=1)===sources.length&&next(images)}(currentTrack=sounds.track1).currentTime=0,currentTrack.loop=!0,next=function(images){var player,startSign,gameHud,game;function showGameOverMenu(){$("#menu").removeClass("main"),$("#menu").show(),$("#gameover").show(),$("#menu").addClass("gameover"),$("#copypaste").hide(),$("#level").text("Level: "+gameInfo.getLevel().toLocaleString()+" x100"),$("#tokens").text("Tokens: "+gameInfo.tokens.toLocaleString()+" x10"),$("#distance").text("Distance: "+gameInfo.distance.toLocaleString()+"m x10"),$("#score").text("Score: "+gameInfo.getScore().toLocaleString())}function toggleGodMode(){gameInfo.god=!gameInfo.god}function resetGame(){livesLeft=5,highScore=localStorage.getItem("highScore"),game.reset(),game.addStaticObject(startSign),gameInfo.reset(),playMusicTrack(1)}function updateHud(message){message=message||"",(gameHud=gameHud||new GameHud({position:{top:50,left:25}})).setLines(["Level "+gameInfo.getLevel(),"Tokens "+gameInfo.tokens,"Life "+livesLeft/totalLives*100+"%","Awake "+player.availableAwake+"/100","Distance "+gameInfo.distance+"m","Speed "+player.getSpeed(),"Total Score "+gameInfo.getScore(),"High Score "+highScore,message]),playMusicTrack(Math.floor(gameInfo.distance/1e3%3)+1)}function spawnMonster(){var newMonster=new Monster(sprites.monster),randomPosition=dContext.getRandomMapPositionAboveViewport();newMonster.setMapPosition(randomPosition[0],randomPosition[1]),newMonster.follow(player),newMonster.onHitting(player,monsterHitsPlayerBehaviour),setTimeout(()=>{var randomPositionAbove;!newMonster||newMonster.isEating||newMonster.isFull||(newMonster.isFull=!0,newMonster.setSpeed(player.getSpeed()),newMonster.stopFollowing(),randomPositionAbove=dContext.getRandomMapPositionAboveViewport(),newMonster.setMapPositionTarget(randomPositionAbove[0],randomPositionAbove[1]))},15e3),game.addMovingObject(newMonster,"monster")}function startGame(){$("#gameover").hide(),$("#selectPlayer").hide(),$("#menu").removeClass("gameover"),$("#menu").removeClass("selectPlayer"),$("#menu").hide(),mainCanvas.style.display="",(player=new Player(sprites.player)).setMapPosition(0,0),player.setMapPositionTarget(0,-10),player.setHitObstacleCb(function(){gameInfo.god||0<livesLeft&&--livesLeft}),player.setHitMonsterCb(()=>{gameInfo.god||(livesLeft=0)}),player.setCollectItemCb(function(item){switch(item.data.name){case"token":gameInfo.tokens+=item.data.pointValues[Math.floor(Math.random()*item.data.pointValues.length)];break;case"milkshake":gameInfo.levelBoost+=1}}),game=new Game(mainCanvas,player),startSign=new Sprite(sprites.signStart),game.addStaticObject(startSign),startSign.setMapPosition(-50,0),dContext.followSprite(player),updateHud(),game.beforeCycle(function(){var dropRate,rateModifier,newObjects=[];player.isMoving&&(newObjects=Sprite.createObjects([{sprite:sprites.jump,dropRate:dropRates.jump},{sprite:sprites.oilSlick,dropRate:dropRates.oilSlick},{sprite:sprites.trafficConeLarge,dropRate:dropRates.trafficConeLarge},{sprite:sprites.trafficConeSmall,dropRate:dropRates.trafficConeSmall},{sprite:sprites.garbageCan,dropRate:dropRates.garbageCan},{sprite:sprites.token,dropRate:dropRates.token},{sprite:sprites.milkshake,dropRate:dropRates.milkshake}],{rateModifier:Math.max(600-mainCanvas.width,0),position:function(){return dContext.getRandomMapPositionBelowViewport()},player:player})),game.isPaused()||(game.addStaticObjects(newObjects),gameInfo.distance=parseFloat(player.getPixelsTravelledDownRoad()/pixelsPerMetre).toFixed(1),gameInfo.distance>monsterDistanceThreshold&&(newObjects=spawnMonster,dropRate=.001*Math.round(gameInfo.distance/1e3),rateModifier=Math.max(800-mainCanvas.width,0),Number.random(1e3+rateModifier)<=dropRate&&newObjects()),gameInfo.distance&&updateHud())}),game.afterCycle(function(){0!==livesLeft||game.isGameEnding()||(game.gameOver(),gameInfo.gameEndDateTime=new Date,gameInfo.getScore()>highScore&&(highScore=localStorage.setItem("highScore",gameInfo.getScore())),playingTrackNumber=0,currentTrack.muted=!0,(currentTrack=sounds.gameOver).currentTime=0,currentTrack.loop=!0,playSound&&(currentTrack.play(),currentTrack.muted=!1),player.isBeingEaten?setTimeout(showGameOverMenu,1e3):(game.pause(),game.cycle(),showGameOverMenu()))}),game.addUIElement(gameHud),$(mainCanvas).mousemove(function(e){game.setMouseX(e.pageX),game.setMouseY(e.pageY),player.resetDirection(),player.startMovingIfPossible()}).bind("click",function(e){game.setMouseX(e.pageX),game.setMouseY(e.pageY),player.resetDirection(),player.startMovingIfPossible()}).focus(),Mousetrap.unbind("v"),Mousetrap.bind("f",player.speedBoost),Mousetrap.bind(["w","up"],function(){player.stop()}),Mousetrap.bind(["a","left"],function(){270===player.direction?player.stepWest():player.turnWest()}),Mousetrap.bind(["s","down"],function(){player.setDirection(180),player.startMovingIfPossible()}),Mousetrap.bind(["d","right"],function(){90===player.direction?player.stepEast():player.turnEast()}),Mousetrap.bind("space",resetGame),$(document).ready(function(){-1!==window.location.href.indexOf("index-dev.html")&&(Mousetrap.bind("m",spawnMonster),Mousetrap.bind("g",toggleGodMode),Mousetrap.bind("h",game.toggleHitBoxes))});var hammertime=new Hammer(mainCanvas);hammertime.on("press",function(e){e.preventDefault(),game.setMouseX(e.center.x),game.setMouseY(e.center.y)}),hammertime.on("tap",function(e){game.setMouseX(e.center.x),game.setMouseY(e.center.y)}),hammertime.on("pan",function(e){game.setMouseX(e.center.x),game.setMouseY(e.center.y),player.resetDirection(),player.startMovingIfPossible()}),hammertime.on("doubletap",function(e){player.speedBoost()}),player.isMoving=!1,player.setDirection(270),game.start(),(currentTrack=sounds.track1).play()}$(".player1").click(function(){sprites.player=sprites.player1,startGame()}),$(".player2").click(function(){sprites.player=sprites.player2,startGame()}),$(".player3").click(function(){sprites.player=sprites.player3,startGame()}),$(".player4").click(function(){sprites.player=sprites.player4,startGame()}),Mousetrap.bind("shift+v",showValidateCodeMenu),$(".copyscore").click(function(){$("#copypaste").show();var s=gameInfo.getFormattedScore();$("#copypastetext").text(s).select(),navigator.clipboard.writeText(s)}),$(".restart").click(function(){$("#gameover").hide(),$("#menu").hide(),resetGame()}),function(){for(var sound in sounds)sounds.hasOwnProperty(sound)&&(sounds[sound].muted=!0,currentTrack.muted=!playSound);mainCanvas.style.display="none",$("#main").show(),$("#menu").addClass("main"),$(".sound").show()}()},loaded=0,images={},(sources=["assets/background.jpg","assets/cart-sprites.png","assets/startsign-sprite.png","assets/oilslick-sprite.png","assets/token-sprites.png","assets/milkshake-sprite.png","assets/malord-sprites.png","assets/hatguy-sprites.png","assets/pilot-sprites.png","assets/romansoldier-sprites.png","assets/skeleton-sprites.png","assets/traffic-cone-large.png","assets/traffic-cone-small.png","assets/garbage-can.png","assets/ramp-sprite.png"]).each(function(src){var im=new Image;im.onload=finish,im.src=src,dContext.storeLoadedImage(src,im)}),this.exports=window},{"./lib/animatedSprite":1,"./lib/canvasRenderingContext2DExtensions":2,"./lib/extenders":3,"./lib/game":4,"./lib/gameHud":5,"./lib/isMobileDevice":7,"./lib/monster":8,"./lib/player":9,"./lib/plugins":10,"./lib/sprite":11,"./lib/spriteArray":12,"./spriteInfo":14,"br-mousetrap":15}],14:[function(require,module,exports){var sprites;require("./lib/game");function obstacleHitsMonsterBehavior(obstacle,monster){obstacle.deleteOnNextCycle()}function obstacleHitsPlayerBehaviour(obstacle,player){player.hasHitObstacle(obstacle)}function playerHitsCollectibleBehaviour(item,player){player.hasHitCollectible(item),item.deleteOnNextCycle()}require=this,(sprites={player:{id:"player",$imageFile:"",parts:{},hitBoxes:{},hitBehavior:{}},player1:{$imageFile:"assets/hatguy-sprites.png",parts:{blank:[0,0,0,0],east:[145,61,70,66,0,0,25,0],esEast:[71,196,65,71,0,0,21,0],sEast:[103,127,52,69,0,0,13,0],south:[60,127,43,68],sWest:[155,127,50,69],wsWest:[0,127,60,66],west:[153,0,65,61],jumping:[0,267,56,87,-3,10],boost:[56,267,43,113,0,-45],wreck1:[0,196,71,70],wreck2:[77,61,68,64],wreck3:[0,0,70,50],wreck4:[136,196,75,71],wreck5:[70,0,83,59],wreck6:[0,61,77,61]},hitBoxes:{0:[0,20,45,60]},id:"player",hitBehaviour:{}},player2:{$imageFile:"assets/pilot-sprites.png",parts:{blank:[0,0,0,0],east:[0,365,70,68,0,0,25,0],esEast:[51,283,65,71,0,0,21,0],sEast:[0,209,57,74,0,0,13,0],south:[0,0,43,68],sWest:[0,135,54,74,0],wsWest:[65,68,60,67],west:[0,68,65,62],jumping:[0,283,51,82,-3,10],boost:[75,562,43,113,0,-45],wreck1:[0,433,68,70],wreck2:[57,209,68,64],wreck3:[43,0,70,50],wreck4:[0,562,75,73],wreck5:[0,503,83,59],wreck6:[54,135,71,59]},hitBoxes:{0:[0,20,45,60]},id:"player",hitBehaviour:{}},player3:{$imageFile:"assets/romansoldier-sprites.png",parts:{blank:[0,0,0,0],east:[131,62,73,70,0,0,25,0],esEast:[72,132,65,71,0,0,21,0],sEast:[132,203,57,74,0,0,13,0],south:[79,203,53,74,0,0,6,0],sWest:[0,62,66,69,0,0,15,0],wsWest:[0,203,79,72,0,0,10,0],west:[66,62,65,69],jumping:[75,277,64,91,-12,10],boost:[139,277,53,122,0,-45],wreck1:[0,132,72,70],wreck2:[77,0,63,59],wreck3:[137,132,70,71],wreck4:[0,277,75,77],wreck5:[0,0,77,55],wreck6:[140,0,72,62]},hitBoxes:{0:[0,20,45,60]},id:"player",hitBehaviour:{}},player4:{$imageFile:"assets/skeleton-sprites.png",parts:{blank:[0,0,0,0],east:[0,68,73,71,0,0,25,0],esEast:[73,68,65,71,0,0,21,0],sEast:[202,68,56,74,0,0,13,0],south:[437,0,43,68],sWest:[258,68,54,74,0],wsWest:[138,68,64,71],west:[290,0,68,66],jumping:[387,68,56,93,-3,10],boost:[443,68,46,122,0,-45],wreck1:[223,0,67,65],wreck2:[155,0,68,64],wreck3:[0,0,71,51],wreck4:[312,68,75,78],wreck5:[71,0,84,59],wreck6:[358,0,79,67]},hitBoxes:{0:[0,20,45,60]},id:"player",hitBehaviour:{}},token:{name:"token",$imageFile:"assets/token-sprites.png",animated:!0,collectible:!0,pointValues:[125,150,175,200,250,300,350,400,450,500],parts:{frame1:[0,0,25,26],frame2:[25,0,25,26],frame3:[50,0,25,26],frame4:[75,0,25,26]},hitBehaviour:{}},oilSlick:{$imageFile:"assets/oilslick-sprite.png",parts:{main:[0,0,40,19]},hitBehaviour:{},isDrawnUnderPlayer:!0},monster:{name:"monster",$imageFile:"assets/malord-sprites.png",parts:{sEast1:[332,149,166,149],sEast2:[0,298,166,149],sWest1:[166,298,166,149],sWest2:[332,298,166,149],eating1:[0,0,166,149],eating2:[166,0,166,149],eating3:[332,0,166,149],eating4:[0,149,166,149],eating5:[166,149,166,149]},hitBoxes:{0:[30,50,145,125]},hitBehaviour:{}},jump:{$imageFile:"assets/ramp-sprite.png",parts:{main:[0,0,54,36]},hitBoxes:{0:[6,3,48,10]},hitBehaviour:{},isDrawnUnderPlayer:!0},signStart:{$imageFile:"assets/startsign-sprite.png",parts:{main:[0,0,42,27]},hitBehaviour:{}},milkshake:{name:"milkshake",$imageFile:"assets/milkshake-sprite.png",collectible:!0,pointValues:[125,150,175,200,250,300,350,400,450,500],parts:{main:[0,0,25,43]},hitBehaviour:{}},trafficConeLarge:{$imageFile:"assets/traffic-cone-large.png",parts:{main:[0,0,39,48]},zIndexesOccupied:[0,1],hitBoxes:{0:[0,26,39,48],1:[12,0,28,20]},hitBehaviour:{}},trafficConeSmall:{$imageFile:"assets/traffic-cone-small.png",parts:{main:[0,0,19,24]},hitBoxes:{0:[0,13,19,24]},hitBehaviour:{}},garbageCan:{$imageFile:"assets/garbage-can.png",parts:{main:[0,0,29,45]},hitBoxes:{0:[1,30,28,44]},hitBehaviour:{}}}).garbageCan.hitBehaviour.monster=obstacleHitsMonsterBehavior,sprites.trafficConeLarge.hitBehaviour.monster=obstacleHitsMonsterBehavior,sprites.trafficConeSmall.hitBehaviour.monster=obstacleHitsMonsterBehavior,sprites.jump.hitBehaviour.monster=obstacleHitsMonsterBehavior,sprites.oilSlick.hitBehaviour.monster=obstacleHitsMonsterBehavior,sprites.jump.hitBehaviour.player=function(jump,player){player.hasHitJump(jump)},sprites.trafficConeLarge.hitBehaviour.player=obstacleHitsPlayerBehaviour,sprites.trafficConeSmall.hitBehaviour.player=obstacleHitsPlayerBehaviour,sprites.garbageCan.hitBehaviour.player=obstacleHitsPlayerBehaviour,sprites.oilSlick.hitBehaviour.player=function(oilSlick,player){player.hasHitOilSlick(oilSlick)},sprites.token.hitBehaviour.player=playerHitsCollectibleBehaviour,sprites.milkshake.hitBehaviour.player=playerHitsCollectibleBehaviour,require.spriteInfo=sprites,void 0!==module&&(module.exports=this.spriteInfo)},{"./lib/game":4}],15:[function(require,module,exports){for(var _REVERSE_MAP,_reset_timer,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc"},_callbacks={},_direct_map={},_sequence_levels={},_ignore_next_keyup=!1,_inside_sequence=!1,i=1;i<20;++i)_MAP[111+i]="f"+i;for(i=0;i<=9;++i)_MAP[i+96]=i;function _addEvent(object,type,callback){object.addEventListener?object.addEventListener(type,callback,!1):object.attachEvent("on"+type,callback)}function _characterFromEvent(e){return"keypress"==e.type?String.fromCharCode(e.which):_MAP[e.which]||_KEYCODE_MAP[e.which]||String.fromCharCode(e.which).toLowerCase()}function _resetSequences(do_not_reset){do_not_reset=do_not_reset||{};var key,active_sequences=!1;for(key in _sequence_levels)do_not_reset[key]?active_sequences=!0:_sequence_levels[key]=0;active_sequences||(_inside_sequence=!1)}function _getMatches(character,modifiers,e,remove,combination){var i,callback,modifiers1,modifiers2,matches=[],action=e.type;if(!_callbacks[character])return[];for("keyup"==action&&_isModifier(character)&&(modifiers=[character]),i=0;i<_callbacks[character].length;++i)(callback=_callbacks[character][i]).seq&&_sequence_levels[callback.seq]!=callback.level||action!=callback.action||("keypress"!=action||e.metaKey||e.ctrlKey)&&(modifiers1=modifiers,modifiers2=callback.modifiers,modifiers1.sort().join(",")!==modifiers2.sort().join(","))||(remove&&callback.combo==combination&&_callbacks[character].splice(i,1),matches.push(callback));return matches}function _fireCallback(callback,e){!1===callback(e)&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0)}function _handleCharacter(character,e){if(!Mousetrap.stopCallback(e,e.target||e.srcElement)){for(var callbacks=_getMatches(character,function(e){var modifiers=[];return e.shiftKey&&modifiers.push("shift"),e.altKey&&modifiers.push("alt"),e.ctrlKey&&modifiers.push("ctrl"),e.metaKey&&modifiers.push("meta"),modifiers}(e),e),do_not_reset={},processed_sequence_callback=!1,i=0;i<callbacks.length;++i)callbacks[i].seq?(processed_sequence_callback=!0,do_not_reset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e)):processed_sequence_callback||_inside_sequence||_fireCallback(callbacks[i].callback,e);e.type!=_inside_sequence||_isModifier(character)||_resetSequences(do_not_reset)}}function _handleKey(e){e.which="number"==typeof e.which?e.which:e.keyCode;var character=_characterFromEvent(e);character&&("keyup"==e.type&&_ignore_next_keyup==character?_ignore_next_keyup=!1:_handleCharacter(character,e))}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _pickBestAction(key,modifiers,action){return action="keypress"==(action=action||(function(){if(!_REVERSE_MAP)for(var key in _REVERSE_MAP={},_MAP)95<key&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key);return _REVERSE_MAP}()[key]?"keydown":"keypress"))&&modifiers.length?"keydown":action}function _bindSequence(combo,keys,callback,action){_sequence_levels[combo]=0,action=action||_pickBestAction(keys[0],[]);function _increaseSequence(e){_inside_sequence=action,++_sequence_levels[combo],clearTimeout(_reset_timer),_reset_timer=setTimeout(_resetSequences,1e3)}function _callbackAndReset(e){_fireCallback(callback,e),"keyup"!==action&&(_ignore_next_keyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)}for(var i=0;i<keys.length;++i)_bindSingle(keys[i],i<keys.length-1?_increaseSequence:_callbackAndReset,action,combo,i)}function _bindSingle(combination,callback,action,sequence_name,level){var i,key,keys,sequence=(combination=combination.replace(/\s+/g," ")).split(" "),modifiers=[];if(1<sequence.length)_bindSequence(combination,sequence,callback,action);else{for(keys="+"===combination?["+"]:combination.split("+"),i=0;i<keys.length;++i)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&"keypress"!=action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push("shift")),_isModifier(key)&&modifiers.push(key);action=_pickBestAction(key,modifiers,action),_callbacks[key]||(_callbacks[key]=[]),_getMatches(key,modifiers,{type:action},!sequence_name,combination),_callbacks[key][sequence_name?"unshift":"push"]({callback:callback,modifiers:modifiers,action:action,seq:sequence_name,level:level,combo:combination})}}_addEvent(document,"keypress",_handleKey),_addEvent(document,"keydown",_handleKey),_addEvent(document,"keyup",_handleKey);var Mousetrap={bind:function(keys,callback,action){return function(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)}(keys instanceof Array?keys:[keys],callback,action),_direct_map[keys+":"+action]=callback,this},unbind:function(keys,action){return _direct_map[keys+":"+action]&&(delete _direct_map[keys+":"+action],this.bind(keys,function(){},action)),this},trigger:function(keys,action){return _direct_map[keys+":"+action](),this},reset:function(){return _callbacks={},_direct_map={},this},stopCallback:function(e,element){return!(-1<(" "+element.className+" ").indexOf(" mousetrap "))&&("INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.contentEditable&&"true"==element.contentEditable)}};window.Mousetrap=Mousetrap,"function"==typeof define&&define.amd&&define("mousetrap",function(){return Mousetrap}),"object"==typeof module&&module.exports&&(module.exports=Mousetrap)},{}],16:[function(require,module,exports){!function(global){!function(){!function(){var root=this,EventEmitter=require("events").EventEmitter,_=require("underscore"),intervalParser=/([0-9\.]+)(ms|s|m|h)?/,root=global||window;function parseEvent(e){e=intervalParser.exec(e);if(!e)throw new Error("I don't understand that particular interval");var intervalAmount=+e[1],e=e[2]||"ms";if("s"===e)intervalAmount*=1e3;else if("m"===e)intervalAmount=1e3*intervalAmount*60;else if("h"===e)intervalAmount=1e3*intervalAmount*60*60;else if(e&&"ms"!==e)throw new Error("You can only specify intervals of ms, s, m, or h");if(intervalAmount<10||intervalAmount%10!=0)throw new Error("You can only specify 10s of milliseconds, trust me on this one");return{amount:intervalAmount,type:e}}function EventedLoop(){this.intervalId=void 0,this.intervalLength=void 0,this.intervalsToEmit={},this.currentTick=1,this.maxTicks=0,this.listeningForFocus=!1;var determineIntervalLength=function(){var potentialIntervalLength=function(intervals){for(var sumOfModuli=1,interval=_.min(intervals);0!==sumOfModuli;)0!==(sumOfModuli=_.reduce(intervals,function(memo,i){return memo+i%interval},0))&&(interval-=10);return interval}(_.keys(this.intervalsToEmit)),changed=!1;return this.intervalLength?potentialIntervalLength!==this.intervalLength&&(this.intervalLength=potentialIntervalLength,changed=!0):this.intervalLength=potentialIntervalLength,this.maxTicks=_.max(_.map(_.keys(this.intervalsToEmit),function(a){return+a}))/this.intervalLength,changed}.bind(this);this.on("newListener",function(e){var intervalAmount;"removeListener"!==e&&"newListener"!==e&&(intervalAmount=parseEvent(e).amount,this.intervalsToEmit[+intervalAmount]=_.union(this.intervalsToEmit[+intervalAmount]||[],[e]),determineIntervalLength()&&this.isStarted()&&this.stop().start())}),this.on("removeListener",function(e){var intervalAmount;0<EventEmitter.listenerCount(this,e)||(intervalAmount=parseEvent(e).amount,e=this.intervalsToEmit[+intervalAmount].removeOne(e),0===this.intervalsToEmit[+intervalAmount].length&&delete this.intervalsToEmit[+intervalAmount],console.log("Determining interval length after removal of",e),determineIntervalLength(),determineIntervalLength()&&this.isStarted()&&this.stop().start())})}void 0===Function.prototype.inherits&&(Function.prototype.inherits=function(parent){this.prototype=Object.create(parent.prototype)}),void 0===Array.prototype.removeOne&&(Array.prototype.removeOne=function(){for(var what,a=arguments,L=a.length;L&&this.length;)if(what=a[--L],-1!==(what=this.indexOf(what)))return this.splice(what,1)}),EventedLoop.inherits(EventEmitter),EventedLoop.prototype.tick=function(){var milliseconds=this.currentTick*this.intervalLength;return _.each(this.intervalsToEmit,function(events,key){milliseconds%key==0&&_.each(events,function(e){this.emit(e,e,key)}.bind(this))}.bind(this)),this.currentTick+=1,this.currentTick>this.maxTicks&&(this.currentTick=1),this},EventedLoop.prototype.start=function(){if(this.intervalLength)return this.intervalId?console.log("No need to start the loop again, it's already started."):(this.intervalId=setInterval(this.tick.bind(this),this.intervalLength),root&&!this.listeningForFocus&&root.addEventListener&&(root.addEventListener("focus",function(){this.start()}.bind(this)),root.addEventListener("blur",function(){this.stop()}.bind(this)),this.listeningForFocus=!0),this);throw new Error("You haven't specified any interval callbacks. Use EventedLoop.on('500ms', function () { ... }) to do so, and then you can start")},EventedLoop.prototype.stop=function(){return clearInterval(this.intervalId),this.intervalId=void 0,this},EventedLoop.prototype.isStarted=function(){return!!this.intervalId},EventedLoop.prototype.every=EventedLoop.prototype.on,void 0!==exports&&((exports=void 0!==module&&module.exports?module.exports=EventedLoop:exports).EventedLoop=EventedLoop),"undefined"!=typeof window&&(window.EventedLoop=EventedLoop)}.call(this)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:17,underscore:18}],17:[function(require,module,exports){"use strict";var R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};var ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function(target){return Object.getOwnPropertyNames(target)},NumberIsNaN=Number.isNaN||function(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter,module.exports.once=function(emitter,name){return new Promise(function(resolve,reject){function errorListener(err){emitter.removeListener(name,resolver),reject(err)}function resolver(){"function"==typeof emitter.removeListener&&emitter.removeListener("error",errorListener),resolve([].slice.call(arguments))}eventTargetAgnosticAddListener(emitter,name,resolver,{once:!0}),"error"!==name&&function(emitter,handler,flags){"function"==typeof emitter.on&&eventTargetAgnosticAddListener(emitter,"error",handler,flags)}(emitter,errorListener,{once:!0})})},(EventEmitter.EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}function _getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var events,existing;return checkListener(listener),void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener||listener),events=target._events),existing=events[type]),void 0===existing?(existing=events[type]=listener,++target._eventsCount):("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),0<(events=_getMaxListeners(target))&&existing.length>events&&!existing.warned&&(existing.warned=!0,(prepend=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",prepend.emitter=target,prepend.type=type,prepend.count=existing.length,listener=prepend,console&&console.warn&&console.warn(listener))),target}function _onceWrap(target,type,listener){target={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},type=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(target);return type.listener=listener,target.wrapFn=type}function _listeners(target,type,unwrap){target=target._events;if(void 0===target)return[];target=target[type];{if(void 0===target)return[];if("function"==typeof target)return unwrap?[target.listener||target]:[target];if(unwrap){for(var arr=target,ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}return arrayClone(target,target.length)}}function listenerCount(type){var events=this._events;if(void 0!==events){events=events[type];if("function"==typeof events)return 1;if(void 0!==events)return events.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}function eventTargetAgnosticAddListener(emitter,name,listener,flags){if("function"==typeof emitter.on)flags.once?emitter.once(name,listener):emitter.on(name,listener);else{if("function"!=typeof emitter.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof emitter);emitter.addEventListener(name,function wrapListener(arg){flags.once&&emitter.removeEventListener(name,wrapListener),listener(arg)})}}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){if((er=0<args.length?args[0]:er)instanceof Error)throw er;doError=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw doError.context=er,doError}var er=events[type];if(void 0===er)return!1;if("function"==typeof er)ReflectApply(er,this,args);else for(var len=er.length,listeners=arrayClone(er,len),i=0;i<len;++i)ReflectApply(listeners[i],this,args);return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){return checkListener(listener),this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){return checkListener(listener),this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if(checkListener(listener),void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;0<=i;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events=this._events;if(void 0===events)return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){for(var key,keys=Object.keys(events),i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;0<=i;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?ReflectOwnKeys(this._events):[]}},{}],18:[function(require,module,exports){!function(){function lookupIterator(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)}function group(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){index=iterator.call(context,value,index,obj);behavior(result,index,value)}),result}}function flatten(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)}function ctor(){}function eq(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(result=(size=a.length)==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result}var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,ObjProto=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)},each=(void 0!==exports?(exports=void 0!==module&&module.exports?module.exports=_:exports)._=_:root._=_,_.VERSION="1.6.0",_.each=_.forEach=function(obj,iterator,context){if(null==obj)return obj;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;return obj}),reduceError=(_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)},"Reduce of empty array with no initial value"),any=(_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=2<arguments.length;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),initial)return memo;throw new TypeError(reduceError)},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=2<arguments.length;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var keys,length=obj.length;if(length!==+length&&(keys=_.keys(obj),length=keys.length),each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),initial)return memo;throw new TypeError(reduceError)},_.find=_.detect=function(obj,predicate,context){var result;return any(obj,function(value,index,list){if(predicate.call(context,value,index,list))return result=value,!0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(predicate,context):(each(obj,function(value,index,list){predicate.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)},_.every=_.all=function(obj,predicate,context){predicate=predicate||_.identity;var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(predicate,context):(each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker}),!!result)},_.some=_.any=function(obj,predicate,context){predicate=predicate||_.identity;var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(predicate,context):(each(obj,function(value,index,list){if(result=result||predicate.call(context,value,index,list))return breaker}),!!result)}),entityMap=(_.contains=_.include=function(obj,target){return null!=obj&&(nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target}))},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);var result=-1/0,lastComputed=-1/0;return each(obj,function(value,index,list){index=iterator?iterator.call(context,value,index,list):value;lastComputed<index&&(result=value,lastComputed=index)}),result},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);var result=1/0,lastComputed=1/0;return each(obj,function(value,index,list){index=iterator?iterator.call(context,value,index,list):value;index<lastComputed&&(result=value,lastComputed=index)}),result},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj=obj.length!==+obj.length?_.values(obj):obj)[_.random(obj.length-1)]:_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(b<a||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),"value")},_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){for(var value=(iterator=lookupIterator(iterator)).call(context,obj),low=0,high=array.length;low<high;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=1+mid:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:(obj.length===+obj.length?obj:_.keys(obj)).length},_.first=_.head=_.take=function(array,n,guard){if(null!=array)return null==n||guard?array[0]:n<0?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){if(null!=array)return null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)},_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.partition=function(array,predicate){var pass=[],fail=[];return each(array,function(elem){(predicate(elem)?pass:fail).push(elem)}),[pass,fail]},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var iterator=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(iterator,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;i<length;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return array[i=_.sortedIndex(array,item)]===item?i:-1;i=isSorted<0?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);idx<length;)range[idx++]=start,start+=step;return range},_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(_.isFunction(func))return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor,result=(ctor.prototype=null,func.apply(self,args.concat(slice.call(arguments))));return Object(result)===result?result:self};throw new TypeError},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;i<length;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher=hasher||_.identity,function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){function later(){previous=!1===options.leading?0:_.now(),timeout=null,result=func.apply(context,args),context=args=null}var context,args,result,timeout=null,previous=0;options=options||{};return function(){var now=_.now(),remaining=(previous||!1!==options.leading||(previous=now),wait-(now-previous));return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){function later(){var last=_.now()-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))}var timeout,args,context,timestamp,result;return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout=timeout||setTimeout(later,wait),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran||(ran=!0,memo=func.apply(this,arguments),func=null),memo}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;0<=i;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var key,keys=[];for(key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var key,names=[];for(key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var key,copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=ObjProto||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return!0===obj||!1===obj||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){return function(obj){if(obj===attrs)return!0;for(var key in attrs)if(attrs[key]!==obj[key])return!1;return!0}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()},{escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}}),entityRegexes=(entityMap.unescape=_.invert(entityMap.escape),{escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")}),idCounter=(_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null!=object)return property=object[property],_.isFunction(property)?property.call(object):property},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})},0),noMatch=(_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},/(.)^/),escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,result=(_.template=function(text,data,settings){settings=_.defaults({},settings,_.templateSettings);var render,matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(source=settings.variable?source:"with(obj||{}){\n"+source+"}\n")+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);function template(data){return render.call(this,data,_)}return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()},function(obj){return this._chain?_(obj).chain():obj});_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this)},{}]},{},[13]);